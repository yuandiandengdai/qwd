<include file="public:headerhall"/>

<h2>游戏大厅--{$room['id']}号房间{$table}号桌</h2>
<div>
    <div id="chartContainer" style="width: 410px;height: 300px;float: left;margin-right: 8px">
    </div>
    <div style="width: 500px;margin: auto;padding-top: 0px;float: left">
        <button id="card" type="button" class="btn btn-info btn-lg">{$room.number|formatNumber=###,0}</button>
        <div id="content" class="cc"></div>
        <div class="game_body">
            <h3>本题题目：</h3>
            <div class="alert alert-info" role="alert" id="question_show">
            </div>
            <h3>开始抢答：</h3>
            <input class="form-control" type="text" id="answer_check" placeholder="请在这里输入你的答案"
                   value="" required/>
        </div>
        <button type="button" currentItem="1" class="btn btn-primary" id="to_validation" onclick="loadPageData()">提交验证
        </button>
    </div>
    <div style="width: 410px;height: 300px;float: left;margin-left: 20px">
        <h3 style="text-align: center">本桌玩家</h3>
        <ol class="room_player_link" style="text-align: center">
            <a href="javascript:void(0)">
                <span class="room_player_font">1号玩家:</span>
                <span class="room_name">&nbsp;{$room.name}</span>
                <span class="room_player_font">准确率:</span>
                <span class="player_num">&nbsp;{$room.count}</span>
            </a>
        </ol>
        <ol class="room_player_link" style="text-align: center">
            <a href="javascript:void(0)">
                <span class="room_player_font">2号玩家:</span>
                <span class="room_name">&nbsp;{$room.name}</span>
                <span class="room_player_font">准确率:</span>
                <span class="player_num">&nbsp;{$room.count}</span>
            </a>
        </ol>
        <ol class="room_player_link" style="text-align: center">
            <a href="javascript:void(0)">
                <span class="room_player_font">3号玩家:</span>
                <span class="room_name">&nbsp;{$room.name}</span>
                <span class="room_player_font">准确率:</span>
                <span class="player_num">&nbsp;{$room.count}</span>
            </a>
        </ol>
    </div>
</div>
<span style="display: none">
    <volist name="question" id="val">
        <p class="subject"><input type="hidden" class="qid" name="qid" value="{$val.id}" id="question_id"/>{$val.question}
        </p>
    </volist>
</span>
<include file="public:footerhall"/>
<script type="text/javascript">
    var flag = true;
    $(function () { //初始化游戏题目信息
        $('#question_show').html($('.subject').first().html());
    });
    var es = new EventSource("__ROOT__/Game/information");
    es.addEventListener("message", function (event) {
        data1 = JSON.parse(event.data);
        var chart = new CanvasJS.Chart("chartContainer", {
            theme: "theme2",
            animationEnabled: false,
            title: {
                text: "本桌答题统计"
            },
            data: [
                {
                    type: "stackedColumn",
                    dataPoints: data1,
                    indexLabel: "#total",
                    indexLabelPlacement: "outside"
                }
            ]
        });
        chart.render();
    }, false);

    var qid = new EventSource("__ROOT__/Game/questionId");
    qid.addEventListener("message", function (event) {
        var x = $('.subject').eq(event.data).html(); //获取下一道题目的问题
        $('#question_show').html(x); //显示赋值
    }, false);

    var numbers = new EventSource("__ROOT__/Game/numbers");
    numbers.addEventListener("message", function (event) {
        $('#card').text(event.data);
    }, false);

    var counter = new EventSource("__ROOT__/Game/counter");
    counter.addEventListener("message", function (event) {
        if((event.data == 0) && (flag == true)){
            var flashMsg = setFlash("本局比赛结束");
            $('#content').html(flashMsg).find('.flashmsg').flashOut();
            $('.game_body').hide(3000);
            $('#to_validation').text("游戏结束");
            $("#to_validation").attr("disabled", true);
            flag = false;
        }
    }, false);
</script>
