<include file="public:header"/>
<include file="public:sidebar"/>
<div class="col-xs-12 col-sm-10 main">
	<!--表格部分-->
	<h3 class="sub-header">玩家管理</h3>
	<div class="table-responsive">
		<table class="table table-hover table-bordered table-condensed">
			<thead>
			<tr>
				<th width="3%">ID</th>
				<th width="9%">玩家姓名</th>
				<th width="14%">玩家邮箱</th>
				<th width="10%">注册时间</th>
				<th width="9%">当前游戏所在房间</th>
				<th width="10%">开始游戏时间</th>
				<th width="7%">赢得游戏总数</th>
				<th width="5%">状态</th>
				<th width="8%">操作</th>
			</tr>
			</thead>
			<tbody class="loaddata">

			</tbody>
		</table>
		<div id="pagecount"></div>
	</div>
</div>
</div>
</div>
<script type="text/javascript" language="javascript">

    $(function () {
        getData(1);
        $("#pagecount").delegate("a", "click", function () {
            var rel = $(this).attr("rel");
            if (rel) {
                getData(rel);
            }
        });
    });

    //获取数据
    function getData(page) {
        var curPage = 1; //当前页码
        var total, pageSize, totalPage;
        $.ajax({
            type: 'POST',
            url: 'http://localhost/php/ajax_users.php',
            data: {'pageNum': page - 1},
            dataType: 'json',
            success: function (json) {
                $(".loaddata").empty();
                total = json.total; //总记录数
                pageSize = json.pageSize; //每页显示条数
                curPage = page; //当前页
                totalPage = json.totalPage; //总页数
                var li = "";
                var list = json.list;
                $.each(list, function (index, array) { //遍历json数据列

                    li += "<tr>" +
                        "<td>" + array['id'] + "</td>" +
                        "<td>" + array['name'] + "</td>" +
                        "<td>" + array['email'] + "</td>" +
                        "<td>" + array['created_at'] + "</td>" +
                        "<td>" + array['rid'] + "</td>" +
                        "<td>" + array['addtime'] + "</td>" +
                        "<td>" + array['onwercount'] + "</td>" +
                        "<td>" + array['status'] + "</td>" +
                        "<td>" + "<a href='#' id='check' onclick=\"check_status('" + array['status'] + "','" +
                        array['id'] +
                        "')\">" + array['status_id'] + "</a>&nbsp;" + "/&nbsp;" +
                        "<a href='#' onclick=\"delete_record('" + array['id'] + "')\">" + "删除</a>" + "</td>" +
                        "</tr>";
                });
                $(".loaddata").append(li);
            },
            complete: function () { //生成分页条
                //页码大于最大页数
                if (curPage > totalPage) curPage = totalPage;
                //页码小于1
                if (curPage < 1) curPage = 1;
                pageStr = "<span>共" + total + "条</span><span>" + curPage + "/" + totalPage + "</span>";

                //如果是第一页
                if (curPage == 1) {
                    pageStr += "<span>首页</span><span>上一页</span>";
                } else {
                    pageStr += "<span><a href='javascript:void(0)' rel='1'>首页</a></span><span><a href='javascript:void(0)' rel='" + (curPage - 1) + "'>上一页</a></span>";
                }

                //如果是最后页
                if (curPage >= totalPage) {
                    pageStr += "<span>下一页</span><span>尾页</span>";
                } else {
                    pageStr += "<span><a href='javascript:void(0)' rel='" + (parseInt(curPage) + 1) + "'>下一页</a></span><span><a href='javascript:void(0)' rel='" + totalPage + "'>尾页</a></span>";
                }

                $("#pagecount").html(pageStr);
            },
            error: function () {
                alert("数据加载失败");
            }
        });
    }

    function delete_record(id) {
        if (confirm("您确定要删除这一玩家么？")) {
            document.location.href = "<?= USERS_ACTION_PATH ?>?act=del&id=" + id;
        }
    }


    function check_status(status, id) {
        if (status == '正常') {
            if (confirm('您确定要踢该玩家下线么？')) {
                window.location.href = "<?= USERS_ACTION_PATH ?>?act=out&id=" + id;
            }
        } else if (status == '已踢下线') {
            if (confirm('您确定要恢复该玩家上线么？')) {
                window.location.href = "<?= USERS_ACTION_PATH ?>?act=on&id=" + id;
            }
        }
    }
</script>
</body>
</html>