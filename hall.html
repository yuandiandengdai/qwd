<include file="public:headerhall"/>

<h2>游戏大厅--{$room['id']}号房间{$table}号桌</h2>
<div>
    <div id="chartContainer" style="width: 800px;height: 300px;float: left">
    </div>
    <div style="width: 500px;margin: auto;padding-top: 0px;">
        <button id="card" type="button" class="btn btn-info btn-lg">{$room.number|formatNumber=###,0}</button>
        <div id="content" class="cc"></div>
        <div class="game_body">
            <h3>本题题目：</h3>
            <div class="alert alert-info" role="alert" id="question_show">
            </div>
            <h3>开始抢答：</h3>
            <input class="form-control" type="text" id="answer_check" placeholder="请在这里输入你的答案"
                   value="" required/>
        </div>
        <button type="button" currentItem="1" class="btn btn-primary" id="to_validation" onclick="loadPageData()">提交验证
        </button>
    </div>
</div>
<span style="display: none">
    <volist name="question" id="val">
        <p class="subject"><input type="hidden" class="qid" name="qid" value="{$val.id}" id="question_id"/>{$val.question}
        </p>
    </volist>
</span>
<script type="text/javascript">
    var data1 = '';
    var data2 = '';
    var data3 = '';
    $(function () { //初始化游戏题目信息
        $('#question_show').html($('.subject').first().html());
    });
//    var es = new EventSource("__ROOT__/Game/information");
//    es.addEventListener("message", function (event) {
//        data1 = JSON.parse(event.data);
//        var chart = new CanvasJS.Chart("chartContainer", {
//            theme: "theme2",
//            animationEnabled: false,
//            title: {
//                text: "本桌答题统计"
//            },
//            data: [
//                {
//                    type: "column",
//                    dataPoints: data1
//                }
//            ]
//        });
//        chart.render();
//    }, false);

    var es2 = new EventSource("__ROOT__/Member/test5");
    es2.addEventListener("message", function (event2) {
        data2 = JSON.parse(event2.data);
    }, false);

    var es3 = new EventSource("__ROOT__/Member/test6");
    es3.addEventListener("message", function (event3) {
        data3 = JSON.parse(event3.data);
    }, false);

    var es1 = new EventSource("__ROOT__/Member/test4");
    es1.addEventListener("message", function (event1) {
        data1 = JSON.parse(event1.data);
        var chart = new CanvasJS.Chart("chartContainer", {
            title: {
                text: "Olympic Medals of all Times (till 2016 Olympics)"
            },
            subtitles: [
                {
                    text: "Click on Legends to Enable/Disable Data Series"
                }
            ],
            animationEnabled: true,
            legend: {
                cursor: "pointer",
                itemclick: function (e) {
                    if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                        e.dataSeries.visible = false;
                    }
                    else {
                        e.dataSeries.visible = true;
                    }
                    chart.render();
                }
            },
            axisY: {
                title: "Medals"
            },
            toolTip: {
                shared: true,
                content: function (e) {
                    var str = '';
                    var total = 0;
                    var str3;
                    var str2;
                    for (var i = 0; i < e.entries.length; i++) {
                        var str1 = "<span style= 'color:" + e.entries[i].dataSeries.color + "'> " + e.entries[i].dataSeries.name + "</span>: <strong>" + e.entries[i].dataPoint.y + "</strong> <br/>";
                        total = e.entries[i].dataPoint.y + total;
                        str = str.concat(str1);
                    }
                    str2 = "<span style = 'color:DodgerBlue; '><strong>" + e.entries[0].dataPoint.label + "</strong></span><br/>";
                    str3 = "<span style = 'color:Tomato '>Total: </span><strong>" + total + "</strong><br/>";

                    return (str2.concat(str)).concat(str3);
                }

            },
            data: [
                {
                    type: "bar",
                    showInLegend: false,
                    name: "Gold",
                    color: "gold",
                    dataPoints:data1
                },
                {
                    type: "bar",
                    showInLegend: false,
                    name: "Silver",
                    color: "silver",
                    dataPoints:data2
                },
                {
                    type: "bar",
                    showInLegend: false,
                    name: "Bronze",
                    color: "#A57164",
                    dataPoints:data3
                }

            ]
        });

        chart.render();
    }, false);
</script>
